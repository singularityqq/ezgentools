<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Background Remover (Google MediaPipe)</title>

    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;">

    <style>
        /* üåë Dark Theme (‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡∏≠‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ ü§£) */
        body { font-family: 'Segoe UI', sans-serif; text-align: center; padding: 40px 20px; background-color: #121212; color: #e0e0e0; }
        .container { max-width: 800px; margin: 0 auto; background: #1e1e1e; padding: 35px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.7); border: 1px solid #333; }
        h1 { margin-bottom: 30px; color: #fff; font-weight: 300; }
        
        /* ‡∏õ‡∏∏‡πà‡∏° Upload ‡∏™‡∏ß‡∏¢‡πÜ */
        .upload-btn-wrapper { position: relative; overflow: hidden; display: inline-block; margin-bottom: 20px; }
        .btn-upload { border: 2px dashed #555; color: white; background-color: #2d2d2d; padding: 15px 40px; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-upload:hover { border-color: #ff00cc; background: #333; }
        .upload-btn-wrapper input[type=file] { font-size: 100px; position: absolute; left: 0; top: 0; opacity: 0; cursor: pointer; }

        /* Canvas ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô */
        canvas { max-width: 100%; border-radius: 12px; margin-top: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.6); background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOwgAADsIBFShKgAAAABp0RVh0U29mdHdhcmUAUGFpbnQuTkVUIHYzLjUuMTAw9HKhAAAAFElEQVQ4T2NTkLCcCMCjYFQxKuCBAEgeOYPZAl1QAAAAAElFTkSuQmCC'); }
        
        button#processBtn { background: linear-gradient(135deg, #ff00cc 0%, #333399 100%); color: white; padding: 14px 40px; font-size: 18px; border: none; border-radius: 50px; cursor: pointer; margin-top: 20px; font-weight: bold; box-shadow: 0 0 15px rgba(255, 0, 204, 0.4); }
        button:disabled { background: #444; color: #888; cursor: not-allowed; box-shadow: none; }
        
        .status { margin-top: 15px; color: #aaa; font-size: 14px; }
        a#downloadLink { display: none; margin-top: 20px; color: #00e676; text-decoration: none; border: 1px solid #00e676; padding: 10px 20px; border-radius: 30px; }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js"></script>
</head>
<body>

<div class="container">
    <h1>‚ú® AI Remover (Google Edition) ‚ú®</h1>
    
    <div class="upload-btn-wrapper">
        <button class="btn-upload">üìÇ Choose Image</button>
        <input type="file" id="imageInput" accept="image/*">
    </div>
    
    <div id="previewContainer">
        <img id="sourceImage" style="display:none;">
    </div>

    <br>
    <button id="processBtn">üöÄ REMOVE BACKGROUND</button>
    <div class="status" id="statusText">(Waiting for image...)</div>
    
    <canvas id="outputCanvas"></canvas>
    <br>
    <a id="downloadLink" href="#">‚¨áÔ∏è Download HD Image</a>
</div>

<script>
    const imageInput = document.getElementById('imageInput');
    const processBtn = document.getElementById('processBtn');
    const statusText = document.getElementById('statusText');
    const sourceImage = document.getElementById('sourceImage');
    const outputCanvas = document.getElementById('outputCanvas');
    const ctx = outputCanvas.getContext('2d');
    const downloadLink = document.getElementById('downloadLink');

    let selfieSegmentation = null;

    // 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏°‡∏≠‡∏á AI (Google MediaPipe)
    async function initAI() {
        statusText.innerText = "‚è≥ Loading Google Brain...";
        selfieSegmentation = new SelfieSegmentation({locateFile: (file) => {
            return `https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}`;
        }});
        
        selfieSegmentation.setOptions({
            modelSelection: 1, // 0 = General, 1 = Landscape (‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏ß‡πà‡∏≤)
        });

        selfieSegmentation.onResults(onResults);
        statusText.innerText = "‚úÖ AI Ready! Select an image.";
        statusText.style.color = "#00e676";
    }

    // 2. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ
    imageInput.addEventListener('change', (e) => {
        if(e.target.files && e.target.files[0]) {
            const reader = new FileReader();
            reader.onload = (event) => {
                sourceImage.src = event.target.result;
                sourceImage.onload = () => {
                    statusText.innerText = "üì∑ Image Loaded. Click 'Remove Background'";
                    statusText.style.color = "#fff";
                }
            };
            reader.readAsDataURL(e.target.files[0]);
        }
    });

    // 3. ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏ö
    processBtn.addEventListener('click', async () => {
        if (!sourceImage.src) { alert("Please select an image first!"); return; }
        if (!selfieSegmentation) { alert("AI is loading... wait a sec!"); return; }

        processBtn.disabled = true;
        processBtn.innerText = "Processing...";
        statusText.innerText = "‚è≥ Cutting Background...";
        
        // ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤ AI
        await selfieSegmentation.send({image: sourceImage});
    });

    // 4. ‡πÄ‡∏°‡∏∑‡πà‡∏≠ AI ‡∏Ñ‡∏¥‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à (Callback)
    function onResults(results) {
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ç‡∏ô‡∏≤‡∏î Canvas ‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á
        outputCanvas.width = results.image.width;
        outputCanvas.height = results.image.height;

        ctx.save();
        ctx.clearRect(0, 0, outputCanvas.width, outputCanvas.height);

        // ‡∏ß‡∏≤‡∏î Mask (‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô)
        ctx.drawImage(results.segmentationMask, 0, 0, outputCanvas.width, outputCanvas.height);

        // ‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ï‡∏±‡∏î‡∏†‡∏≤‡∏û (Composite)
        ctx.globalCompositeOperation = 'source-in'; // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ö‡∏Å‡∏±‡∏ö Mask (‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏ô)
        ctx.drawImage(results.image, 0, 0, outputCanvas.width, outputCanvas.height);

        ctx.restore();

        // ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!
        processBtn.disabled = false;
        processBtn.innerText = "üöÄ REMOVE BACKGROUND";
        statusText.innerText = "‚úÖ Done! Smooth & Clean!";
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
        downloadLink.style.display = "inline-block";
        downloadLink.href = outputCanvas.toDataURL('image/png');
        downloadLink.download = "removed-bg-google.png";
    }

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î AI ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö
    initAI();
</script>

</body>
</html>
