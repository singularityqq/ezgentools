<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Space Dodge - EzGenTools</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* --- ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö --- */
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            color: white;
            font-family: 'Poppins', 'Segoe UI', sans-serif; /* ‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå Poppins ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô EzGenTools */
            overflow: hidden;
            touch-action: none;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            position: relative;
        }

        /* --- üåü ‡πÇ‡∏•‡πÇ‡∏Å‡πâ EzGenTools (‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô) --- */
        .logo-container {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 20; /* ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏™‡∏∏‡∏î */
        }
        .logo-link {
            text-decoration: none;
            display: flex;
            align-items: center;
        }
        /* ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡πá‡∏ö EzGenTools */
        .logo-text {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(to right, #00e676, #00c853);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 1px;
        }
        .logo-text span {
            color: #fff;
            -webkit-text-fill-color: #fff;
            font-weight: 600;
        }

        /* --- ‡∏ï‡∏±‡∏ß‡πÄ‡∏Å‡∏° --- */
        canvas {
            border: 2px solid #00e676;
            box-shadow: 0 0 30px rgba(0, 230, 118, 0.3);
            background: radial-gradient(circle, #1a0033 0%, #000000 100%);
            border-radius: 12px;
            max-width: 100%;
            max-height: 100%;
        }
        #ui-layer {
            position: absolute;
            text-align: center;
            pointer-events: none;
            z-index: 10;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        #inGameScore {
            position: absolute;
            top: 80px; /* ‡∏Ç‡∏¢‡∏±‡∏ö‡∏•‡∏á‡∏°‡∏≤‡∏´‡∏•‡∏ö‡πÇ‡∏•‡πÇ‡∏Å‡πâ */
            width: 100%;
            text-align: center;
            font-size: 60px;
            font-weight: 800;
            text-shadow: 0 0 15px #00e676;
            display: none;
        }

        #menuScreen {
            background: rgba(0, 0, 0, 0.85);
            padding: 30px 20px;
            border-radius: 20px;
            border: 1px solid #444;
            backdrop-filter: blur(5px);
            width: 85%;
            max-width: 400px;
            pointer-events: auto;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }

        h1 { margin: 0; text-shadow: 0 0 15px #00e676; font-size: 36px; font-weight: 800; color: #fff; }
        h2 { color: #ff1744; margin: 10px 0; font-size: 32px; text-shadow: 0 0 10px red; }
        p { margin: 15px 0; color: #ccc; font-size: 16px; }

        #startBtn {
            background: linear-gradient(45deg, #ff00cc, #333399);
            color: white;
            border: none;
            padding: 15px 50px;
            font-size: 22px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 0 20px rgba(255, 0, 204, 0.6);
            margin-top: 10px;
            width: 100%;
            transition: transform 0.1s, box-shadow 0.1s;
        }
        #startBtn:active { transform: scale(0.95); box-shadow: 0 0 10px rgba(255, 0, 204, 0.4); }

        #ad-slot {
            margin-top: 25px;
            width: 100%;
            height: 100px;
            background-color: #1a1a1a;
            border: 1px dashed #444;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #666;
            font-size: 12px;
            border-radius: 8px;
            overflow: hidden;
        }
    </style>
</head>
<body>

<div class="logo-container">
    <a href="https://ezgentools.com/" class="logo-link">
        <div class="logo-text">EzGen<span>Tools</span></div>
    </a>
</div>

<div id="ui-layer">
    <div id="inGameScore">0</div>

    <div id="menuScreen">
        <h1 id="gameTitle">SPACE DODGE</h1>
        <h2 id="gameOverTitle" style="display:none;">‡∏¢‡∏≤‡∏ô‡πÅ‡∏ï‡∏Å! üí•</h2>
        
        <p id="scoreLabel">‡πÅ‡∏ï‡∏∞‡∏à‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</p>
        <p id="finalScore" style="display:none; font-size:24px; color:#00e676; font-weight:bold;"></p>

        <button id="startBtn">START</button>

        <div id="ad-slot">
            <span>[ ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡∏ó‡∏≥‡πÄ‡∏á‡∏¥‡∏ô ]<br>(AdSense Placeholder)</span>
        </div>
    </div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const menuScreen = document.getElementById('menuScreen');
    const gameTitle = document.getElementById('gameTitle');
    const gameOverTitle = document.getElementById('gameOverTitle');
    const scoreLabel = document.getElementById('scoreLabel');
    const finalScore = document.getElementById('finalScore');
    const startBtn = document.getElementById('startBtn');
    const inGameScore = document.getElementById('inGameScore');

    // --- üîä ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡πä‡∏Å) ---
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    let audioCtx = new AudioContext();

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏•‡∏∏‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å!)
    function resumeAudio() {
        if (audioCtx.state === 'suspended') {
            audioCtx.resume();
        }
    }

    function playSound(type) {
        // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á resume ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡πÄ‡∏•‡∏¢
        const osc = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        if (type === 'jump') {
            osc.type = 'sine'; osc.frequency.setValueAtTime(600, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.1); gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1); osc.start(); osc.stop(audioCtx.currentTime + 0.1);
        } else if (type === 'score') {
            osc.type = 'triangle'; osc.frequency.setValueAtTime(800, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1); gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2); osc.start(); osc.stop(audioCtx.currentTime + 0.2);
        } else if (type === 'crash') {
            osc.type = 'sawtooth'; osc.frequency.setValueAtTime(100, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(10, audioCtx.currentTime + 0.3); gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3); osc.start(); osc.stop(audioCtx.currentTime + 0.3);
        }
    }

    // --- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ ---
    function resize() {
        canvas.width = window.innerWidth > 500 ? 480 : window.innerWidth;
        canvas.height = window.innerHeight;
    }
    resize();
    window.addEventListener('resize', resize);

    // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡∏°
    let player, enemies, stars, score, gameRunning, animationId;
    let speedMultiplier = 1;
    let frameCount = 0;

    // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° ---
    let targetX = null;
    let isTouching = false;
    let keys = {};
    window.addEventListener('keydown', e => keys[e.key] = true);
    window.addEventListener('keyup', e => keys[e.key] = false);
    
    canvas.addEventListener('touchstart', e => { isTouching = true; targetX = getTouchPos(e); e.preventDefault(); }, {passive: false});
    canvas.addEventListener('touchmove', e => { if (isTouching) targetX = getTouchPos(e); e.preventDefault(); }, {passive: false});
    canvas.addEventListener('touchend', () => { isTouching = false; targetX = null; });

    function getTouchPos(e) {
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        return (e.touches[0].clientX - rect.left) * scaleX;
    }

    // --- ‡∏Å‡∏£‡∏≤‡∏ü‡∏¥‡∏Å ---
    function initStars() {
        stars = [];
        for(let i=0; i<60; i++) {
            stars.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, size: Math.random() * 2, speed: Math.random() * 2 + 0.5 });
        }
    }
    function drawStars() {
        ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
        stars.forEach(star => { ctx.beginPath(); ctx.arc(star.x, star.y, star.size, 0, Math.PI*2); ctx.fill(); star.y += star.speed; if(star.y > canvas.height) star.y = 0; });
    }
    function drawMeteor(x, y, size) {
        let gradient = ctx.createRadialGradient(x + size/2, y + size/2, size/5, x + size/2, y + size/2, size/2);
        gradient.addColorStop(0, '#ffeb3b'); gradient.addColorStop(0.4, '#ff5722'); gradient.addColorStop(1, 'rgba(183, 28, 28, 0)');
        ctx.fillStyle = gradient; ctx.beginPath(); ctx.arc(x + size/2, y + size/2, size/2, 0, Math.PI*2); ctx.fill();
    }
    function drawSpaceship(x, y, w, h) {
        ctx.shadowBlur = 15; ctx.shadowColor = "#00e676"; ctx.fillStyle = "#00e676";
        ctx.beginPath(); ctx.moveTo(x + w/2, y); ctx.lineTo(x + w, y + h); ctx.lineTo(x + w/2, y + h - 15); ctx.lineTo(x, y + h); ctx.closePath(); ctx.fill(); ctx.shadowBlur = 0;
    }

    // --- üî• ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏ú‡∏π‡∏Å Event Listener ‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ---
    startBtn.addEventListener('click', () => {
        // 1. ‡∏õ‡∏•‡∏∏‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏Å‡∏î
        resumeAudio();
        // 2. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
        startGame();
    });
    // ‡πÄ‡∏û‡∏¥‡πà‡∏° touchstart ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏ö‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà click ‡πÑ‡∏°‡πà‡πÑ‡∏ß‡∏û‡∏≠
    startBtn.addEventListener('touchstart', (e) => {
        e.preventDefault(); // ‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡∏ã‡πâ‡∏≥
        resumeAudio();
        startGame();
    }, {passive: false});


    // --- Game Logic ---
    function startGame() {
        // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å resumeAudio() ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
        playSound('jump');
        menuScreen.style.display = 'none';
        inGameScore.style.display = 'block';
        
        player = { x: canvas.width/2 - 25, y: canvas.height - 120, w: 50, h: 60, speed: 8 };
        enemies = [];
        score = 0;
        frameCount = 0;
        speedMultiplier = 1;
        gameRunning = true;
        inGameScore.innerText = score;
        
        initStars();
        if (animationId) cancelAnimationFrame(animationId); // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå loop ‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
        loop();
    }

    function loop() {
        if (!gameRunning) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawStars();

        if (keys['ArrowLeft'] && player.x > 0) player.x -= player.speed;
        if (keys['ArrowRight'] && player.x < canvas.width - player.w) player.x += player.speed;
        if (targetX !== null) {
            let dx = targetX - (player.x + player.w/2);
            if (Math.abs(dx) > 5) player.x += Math.sign(dx) * player.speed;
        }
        if (player.x < 0) player.x = 0; if (player.x > canvas.width - player.w) player.x = canvas.width - player.w;

        drawSpaceship(player.x, player.y, player.w, player.h);

        frameCount++;
        if (frameCount % Math.max(20, 50 - Math.floor(score/50)) === 0) { 
            const size = Math.random() * 40 + 30;
            enemies.push({ x: Math.random() * (canvas.width - size), y: -size, w: size, h: size, speed: Math.random() * 3 + 3 + speedMultiplier });
        }
        if (frameCount % 500 === 0) speedMultiplier += 0.5;

        for (let i = enemies.length - 1; i >= 0; i--) {
            let enemy = enemies[i];
            enemy.y += enemy.speed;
            drawMeteor(enemy.x, enemy.y, enemy.w);

            if (player.x + 10 < enemy.x + enemy.w - 10 && player.x + player.w - 10 > enemy.x + 10 && player.y + 15 < enemy.y + enemy.h - 15 && player.h + player.y > enemy.y + 15) {
                gameOver(); return;
            }
            if (enemy.y > canvas.height) {
                enemies.splice(i, 1); score += 10; inGameScore.innerText = score;
                if (score % 100 === 0) playSound('score'); 
            }
        }
        animationId = requestAnimationFrame(loop);
    }

    function gameOver() {
        gameRunning = false;
        playSound('crash');
        menuScreen.style.display = 'block';
        gameTitle.style.display = 'none';
        gameOverTitle.style.display = 'block';
        scoreLabel.style.display = 'none';
        finalScore.style.display = 'block';
        finalScore.innerText = "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: " + score;
        startBtn.innerText = "‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á";
        inGameScore.style.display = 'none';
    }

</script>

</body>
</html>
